<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shadows of Doubt Dashboard</title>
  <meta name="description" content="Local dashboard for Shadows of Doubt mod" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <!-- Noir animated background (pure HTML/CSS) -->
  <div class="noir-background" aria-hidden="true">
    <div class="gradient-layer"></div>
    <div class="film-grain"></div>
    <div class="vignette"></div>
    <div class="parallax-layer">
      <div class="grid-layer"></div>
      <div class="scan-sweep"></div>
      <div class="glow-orb-1"></div>
      <div class="glow-orb-2"></div>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo" aria-label="Shadows of Doubt">
          <svg class="logo-svg" viewBox="0 0 36 36" role="img" aria-hidden="true">
            <defs>
              <linearGradient id="logo-grad" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="var(--accent)"/>
                <stop offset="100%" stop-color="var(--accent-2)"/>
              </linearGradient>
              <filter id="logo-glow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="1.8" result="blur"/>
                <feMerge>
                  <feMergeNode in="blur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>
            <!-- Outer ring (O) with animated dash -->
            <circle cx="18" cy="18" r="18" class="ring neon"/>
            <!-- Letters now rendered as real text overlays (see .logo-t-left/.logo-t-right) -->
          </svg>
          <span class="logo-letters" aria-hidden="true"><span>S</span><span>O</span><span>D</span></span>
        </div>
        <div class="title">Dashboard</div>
      </div>
      <nav class="nav">
        <a class="nav-item active" href="?view=home" data-view="home">
          <span>Overview</span>
        </a>
        <a class="nav-item" href="?view=npcs" data-view="npcs">
          <span>NPCs</span>
        </a>
        <a class="nav-item" href="?view=relationships" data-view="relationships">
          <span>Relationships</span>
        </a>
        <a class="nav-item" href="?view=addresses" data-view="addresses">
          <span>Addresses</span>
        </a>
        <a class="nav-item" href="?view=player" data-view="player">
          <span>Player</span>
        </a>
        <a class="nav-item" href="?view=map" data-view="map">
          <span>Map</span>
        </a>
        <a class="nav-item" href="?view=stats" data-view="stats">
          <span>Stats</span>
        </a>
        <a class="nav-item" href="?view=methods" data-view="methods">
          <span>Code Execution</span>
        </a>
        <a class="nav-item" href="?view=console" data-view="console">
          <span>Console</span>
        </a>
        <div class="spacer"></div>
        <a class="nav-item" href="?view=settings" data-view="settings">
          <span>Settings</span>
        </a>
      </nav>
      <div class="status">
        <div class="dot" id="health-dot"></div>
        <div class="status-text" id="health-text">Connectingâ€¦</div>
      </div>
    </aside>

    <main class="content">
      <header class="topbar">
        <h1 id="view-title">Overview</h1>
        <div class="topbar-actions">
          <button id="refresh-btn" class="btn">Refresh</button>
        </div>
      </header>

      <section id="view-home" class="view active">
        <div class="cards">
          <div class="card">
            <div class="card-title">Server</div>
            <div class="kv">
              <div><span class="k">Status: </span><span class="v" id="server-status">â€”</span></div>
              <div><span class="k">Port: </span><span class="v" id="server-port">â€”</span></div>
              <div><span class="k">Time: </span><span class="v" id="server-time">â€”</span></div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">Game</div>
            <div class="kv">
              <div><span class="k">Save: </span><span class="v" id="game-save">â€”</span></div>
              <div><span class="k">City: </span><span class="v" id="game-city">â€”</span></div>
              <div><span class="k">Time: </span><span class="v" id="game-time">â€”</span></div>
              <div><span class="k">Murder MO: </span><span class="v" id="game-mo">â€”</span></div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">Quick Links</div>
            <ul class="links">
              <li><a href="/api/health" target="_blank">API: Health</a></li>
              <li><a href="/api/info" target="_blank">API: Info</a></li>
            </ul>
          </div>
        </div>

        <div style="margin-top:24px">
          <h2 style="margin-bottom:16px; font-size:18px; font-weight:600">Current Murder Case</h2>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:24px">
            <div id="murderer-card" class="placeholder">Loading murderer...</div>
            <div id="victim-card" class="placeholder">Loading victim...</div>
          </div>
        </div>

        <div style="margin-top:24px">
          <h2 style="margin-bottom:16px; font-size:18px; font-weight:600">Recent Deaths</h2>
          <div id="deaths-list" class="placeholder">Loading deaths...</div>
        </div>
      </section>

      <section id="view-console" class="view">
        <div class="toolbar">
          <button id="logs-refresh" class="btn">Refresh</button>
          <label class="metric-label ml-8"><input type="checkbox" id="logs-live" checked> Live</label>
          <label class="metric-label ml-8"><input type="checkbox" id="logs-autoscroll" checked> Autoscroll</label>
          <label class="metric-label ml-12">Tail:
            <select id="logs-tail" class="input ml-6">
              <option value="200">200</option>
              <option value="500" selected>500</option>
              <option value="1000">1000</option>
              <option value="2000">2000</option>
            </select>
          </label>
          <input id="logs-filter" class="input ml-12" type="text" placeholder="Filter (substring or /regex/)" />
          <div class="spacer"></div>
          <div id="logs-path" class="metric-label">â€”</div>
        </div>
        <div id="logs-output" class="console-output">Loadingâ€¦</div>
      </section>

      <section id="view-npcs" class="view">
        <div class="toolbar">
          <input id="npc-search" class="input" type="text" placeholder="Search by name or surname..." />
          <button id="npc-refresh" class="btn">Refresh</button>
        </div>
        <div id="npc-list" class="npc-list"></div>
      </section>

      <section id="view-relationships" class="view">
        <div class="toolbar" style="display:flex; gap:12px; align-items:center">
          <label class="metric-label">View:
            <select id="rel-view-type" class="input" style="margin-left:8px">
              <option value="city">City (50 NPCs)</option>
              <option value="npc">Specific NPC</option>
            </select>
          </label>
          <input id="rel-npc-id" class="input" type="number" placeholder="NPC ID" style="width:120px; display:none" />
          <button id="rel-load" class="btn">Load Graph</button>
          <div class="spacer"></div>
          <label class="metric-label">
            <input type="checkbox" id="rel-show-labels" checked> Show Labels
          </label>
        </div>
        <div id="rel-stats" style="padding:12px; display:none">
          <span class="metric-label" style="margin-right:16px">Nodes: <strong id="rel-node-count">0</strong></span>
          <span class="metric-label">Connections: <strong id="rel-edge-count">0</strong></span>
        </div>
        <div style="display:flex; gap:16px">
          <canvas id="rel-canvas" style="flex:1; height:calc(100vh - 240px); background:rgba(0,0,0,0.2); border-radius:8px; cursor:grab"></canvas>
          <div class="card" style="width:250px; padding:16px; height:fit-content">
            <div class="card-title">Legend</div>
            <div style="margin-top:12px; font-size:12px">
              <div style="font-weight:600; margin-bottom:8px">Relationship Types:</div>
              <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px">
                <div style="width:30px; height:3px; background:rgb(255, 100, 150)"></div>
                <span>Romantic (partners)</span>
              </div>
              <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px">
                <div style="width:30px; height:3px; background:rgb(100, 200, 100)"></div>
                <span>Roommate (same home)</span>
              </div>
              <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px">
                <div style="width:30px; height:3px; background:rgb(100, 150, 255)"></div>
                <span>Colleague (coworkers)</span>
              </div>
              <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px">
                <div style="width:30px; height:3px; background:rgb(255, 200, 100)"></div>
                <span>Friend (close)</span>
              </div>
              <div style="display:flex; align-items:center; gap:8px; margin-bottom:12px">
                <div style="width:30px; height:3px; background:rgb(150, 150, 150)"></div>
                <span>Acquaintance</span>
              </div>
              <div style="font-weight:600; margin-bottom:8px">Connection Properties:</div>
              <div style="margin-bottom:4px">â€¢ <strong>Thickness:</strong> Relationship strength</div>
              <div style="margin-bottom:4px">â€¢ <strong>Brightness:</strong> Mutual (both know each other)</div>
              <div style="margin-bottom:4px">â€¢ <strong>Node size:</strong> Number of connections</div>
              <div style="margin-bottom:4px">â€¢ <strong>Node color:</strong> Connection count</div>
              <div style="margin-top:12px; padding:8px; background:rgba(109,197,255,0.1); border-radius:6px; font-size:11px; color:var(--muted)">
                ðŸ’¡ Drag nodes to rearrange the graph
              </div>
            </div>
          </div>
        </div>
        <div id="rel-tooltip" style="position:absolute; background:var(--card); border:1px solid var(--border); border-radius:8px; padding:8px 12px; pointer-events:none; display:none; font-size:12px; box-shadow:0 4px 12px rgba(0,0,0,0.3)"></div>
      </section>

      <section id="view-addresses" class="view">
        <div class="toolbar">
          <input id="address-search" class="input" type="text" placeholder="Search by name or building..." />
          <label class="metric-label ml-12">
            <select id="address-filter" class="input ml-6" aria-label="Filter addresses by type">
              <option value="all">All Addresses</option>
              <option value="residence">Residences Only</option>
              <option value="business">Businesses Only</option>
            </select>
          </label>
          <label class="metric-label ml-12">
            <select id="address-count-filter" class="input ml-6" aria-label="Filter by occupant count">
              <option value="any">Any Count</option>
              <option value="empty">Empty (0)</option>
              <option value="has">Has Occupants (1+)</option>
              <option value="1">Exactly 1</option>
              <option value="2">Exactly 2</option>
              <option value="3+">3 or More</option>
            </select>
          </label>
          <button id="address-refresh" class="btn">Refresh</button>
        </div>
        <div id="address-list" class="npc-list"></div>
      </section>

      <section id="view-player" class="view">
        <div class="card">
          <div class="card-title">Spawn Item To Inventory</div>
          <div class="kv">
            <div class="form-row">
              <label class="k" for="player-search">Search:</label>
              <span class="v">
                <input id="player-search" class="input" type="text" placeholder="Search presets..." />
              </span>
            </div>
            <div class="form-row">
              <label class="k" for="player-preset">Preset:</label>
              <span class="v">
                <select id="player-preset" class="input" aria-label="Interactable preset"></select>
              </span>
            </div>
            <div class="row-actions">
              <button id="player-spawn" class="btn">Spawn Selected</button>
            </div>
            <div id="player-status" class="dev-status dev-status-info mt-10">â€”</div>
          </div>
        </div>

        <div class="card mt-20">
          <div class="card-title">Player Status</div>
          <div class="kv">
            <div class="form-row">
              <label class="k">Health:</label>
              <span class="v">
                <div class="bar bar-health"><div id="player-health-fill" class="bar-fill"></div></div>
                <div id="player-health-text" class="metric-label">â€”</div>
              </span>
            </div>

            <div class="form-row"><label class="k">Hunger:</label><span class="v"><div class="bar bar-need"><div id="player-hunger-fill" class="bar-fill"></div></div><div id="player-hunger-text" class="metric-label">â€”</div></span></div>
            <div class="form-row"><label class="k">Thirst:</label><span class="v"><div class="bar bar-need"><div id="player-thirst-fill" class="bar-fill"></div></div><div id="player-thirst-text" class="metric-label">â€”</div></span></div>
            <div class="form-row"><label class="k">Tiredness:</label><span class="v"><div class="bar bar-need"><div id="player-tiredness-fill" class="bar-fill"></div></div><div id="player-tiredness-text" class="metric-label">â€”</div></span></div>
            <div class="form-row"><label class="k">Energy:</label><span class="v"><div class="bar bar-need"><div id="player-energy-fill" class="bar-fill"></div></div><div id="player-energy-text" class="metric-label">â€”</div></span></div>

            <div class="form-row"><label class="k">Stinky:</label><span class="v"><div class="bar bar-status"><div id="player-stinky-fill" class="bar-fill"></div></div><div id="player-stinky-text" class="metric-label">â€”</div></span></div>
            <div class="form-row"><label class="k">Cold:</label><span class="v"><div class="bar bar-status"><div id="player-cold-fill" class="bar-fill"></div></div><div id="player-cold-text" class="metric-label">â€”</div></span></div>
            <div class="form-row"><label class="k">Wet:</label><span class="v"><div class="bar bar-status"><div id="player-wet-fill" class="bar-fill"></div></div><div id="player-wet-text" class="metric-label">â€”</div></span></div>
            <div class="form-row"><label class="k">Headache:</label><span class="v"><div class="bar bar-status"><div id="player-headache-fill" class="bar-fill"></div></div><div id="player-headache-text" class="metric-label">â€”</div></span></div>
            <div class="form-row"><label class="k">Bruised:</label><span class="v"><div class="bar bar-status"><div id="player-bruised-fill" class="bar-fill"></div></div><div id="player-bruised-text" class="metric-label">â€”</div></span></div>
            <div class="form-row"><label class="k">Bleeding:</label><span class="v"><div class="bar bar-status"><div id="player-bleeding-fill" class="bar-fill"></div></div><div id="player-bleeding-text" class="metric-label">â€”</div></span></div>
          </div>
        </div>
      </section>

      <section id="view-map" class="view">
        <div class="toolbar">
          <button id="map-refresh" class="btn">Refresh</button>
          <label class="metric-label ml-12">Floor:
            <select id="map-floor" class="input ml-6"></select>
          </label>
          <div class="spacer"></div>
          <div id="map-active" class="metric-label">â€”</div>
        </div>
        <div class="map-grid">
          <div class="map-panel preview">
            <div class="card-title">Preview</div>
            <img id="map-image" class="map-image" alt="Minimap preview" />
          </div>
          <div class="map-panel">
            <div class="card-title">Layers</div>
            <div id="map-layers" class="list"></div>
          </div>
          <div class="map-panel">
            <div class="card-title">Hierarchy</div>
            <pre id="map-tree" class="console-output map-tree"></pre>
          </div>
        </div>
      </section>

      <section id="view-methods" class="view">
        <div class="toolbar" style="display:flex; gap:12px; align-items:center; margin-bottom:16px">
          <button id="method-tab-search" class="btn" style="background:var(--accent); color:var(--bg)">Method Browser</button>
          <button id="method-tab-code" class="btn">Code Editor</button>
        </div>

        <div id="method-panel-search">
          <div class="toolbar">
            <input id="method-search" class="input" type="text" placeholder="Search methods (e.g., TryPickNewVictimSite)..." />
            <button id="method-search-btn" class="btn">Search</button>
          </div>
          <div id="method-results" class="placeholder">Enter a method name to search</div>
          <div id="method-details" style="display:none; margin-top:24px;">
            <div class="card">
              <div class="card-title">Method Details</div>
              <div id="method-info"></div>
              <div id="method-params" style="margin-top:16px"></div>
              <button id="method-invoke-btn" class="btn" style="margin-top:16px">Execute Method</button>
            </div>
            <div id="method-result" style="margin-top:16px"></div>
          </div>
        </div>

        <div id="method-panel-code" style="display:none">
          <div class="card" style="margin-bottom:16px">
            <div class="card-title">C# Code Editor</div>
            <div style="margin-bottom:12px; font-size:13px; color:var(--muted)">
              Execute method calls using reflection. Format: ClassName.Instance.MethodName(args)
            </div>
            <textarea id="code-editor" placeholder="Examples:

MurderController.Instance.TryPickNewVictimSite()

Player.Instance.SetHealth(100.0)

SessionData.Instance.PauseGame()

Game.Log(&quot;Hello from dashboard!&quot;)

Note: Use the Method Browser tab for more advanced searching and parameter help."></textarea>
            <button id="code-execute-btn" class="btn">Execute Code</button>
          </div>
          <div id="code-result"></div>
        </div>
      </section>

      <section id="view-stats" class="view">
        <div class="placeholder">Graphs and KPIs about the current city and case.</div>
      </section>

      <section id="view-settings" class="view">
        <div class="card">
          <div class="card-title">Theme</div>
          <div class="kv">
            <div class="form-row">
              <label class="k">Color:</label>
              <span class="v theme-options">
                <label><input type="radio" name="theme" value="blue" id="theme-blue"> Blue</label>
                <label><input type="radio" name="theme" value="red" id="theme-red"> Red</label>
                <label><input type="radio" name="theme" value="green" id="theme-green"> Green</label>
                <label><input type="radio" name="theme" value="yellow" id="theme-yellow"> Yellow</label>
                <label><input type="radio" name="theme" value="purple" id="theme-purple"> Purple</label>
                <label><input type="radio" name="theme" value="cyan" id="theme-cyan"> Cyan</label>
                <label><input type="radio" name="theme" value="pink" id="theme-pink"> Pink</label>
                <label><input type="radio" name="theme" value="colorblind" id="theme-colorblind"> Colorâ€‘blind Friendly</label>
              </span>
            </div>
            <div class="form-row">
              <label class="k">Custom:</label>
              <span class="v">
                <label><input type="radio" name="theme" value="custom" id="theme-custom"> Use color</label>
                <input type="color" id="custom-color" value="#00b3ff" aria-label="Pick custom neon color" />
              </span>
            </div>
            <div class="metric-label">Applies instantly and is saved in your browser.</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="./app.js"></script>
  <script src="./app_relationships.js"></script>
</body>
</html>
